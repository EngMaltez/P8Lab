pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- snake
-- by zetlam
-- spent: ⧗⧗⧗⧗ ⧗⧗⧗⧗ ⧗⧗
--
-- todo:


ticks = 0
move_beat=10
grid_size=4
wall_left = 0
wall_right=flr(128/grid_size)-1
wall_top = 0
wall_bottom=flr(128/grid_size)-1

dx,dy = 0,0
fruits={}
body={}

function _init()
 --	initialize_game()
 _update = update_main_menu
 _draw = draw_main_menu
end

function initialize_game()
	move_beat=10
	dx,dy = 0,0
	fruits = {}
	body={{
			x=flr(128/grid_size/2),
			y=flr(128/grid_size/2)
	}}
	for i=1,2 do
		grow_snake()
	end
	create_fruit()
	_draw = draw_game
	_update = update_game
end

function update_game()
	-- button presses
	if (btnp(⬅️)) dx,dy = -1,0
	if (btnp(➡️)) dx,dy = 1,0
	if (btnp(⬆️)) dx,dy = 0,-1
	if (btnp(⬇️)) dx,dy = 0,1
	-- update skake on beat
	ticks += 1
	if (ticks>=move_beat) then
		ticks = 0
		if (dx!=0 or dy!=0) then
			move_snake(dx,dy)
			sfx(1)
			head = body[1]
			-- check ate fruit
			for fruit in all(fruits) do
				if fruit.x == head.x and fruit.y == head.y then
					grow_snake()
					del(fruits,fruit)
					create_fruit()
					sfx(2)
					if (#body%8==0) then
						move_beat -= 1 
					end
				end
			end
			-- check ate itself
			for i=2,#body do
				seg=body[i]
				if head.x == seg.x and head.y == seg.y then
					_draw = draw_gameover
					_update = update_gameover
					sfx(3)
				end
			end
			-- check hit wall
			if head.x <= wall_left
				or head.x >= wall_right
				or head.y <= wall_top
				or head.y >= wall_bottom then
				_draw = draw_gameover
				_update = update_gameover
				sfx(3)
			end
		end
	end
end -- end update_game

function draw_game()
	cls(1)
	draw_snake()
	-- draw wall
	rectfill(
		wall_left*grid_size,
		wall_top*grid_size,
		(wall_right+1)*grid_size-1,
		grid_size-1,
		5)
	rectfill(
		wall_left*grid_size,
		wall_bottom*grid_size,
		(wall_right+1)*grid_size-1,
		(wall_bottom+1)*grid_size-1,
		5)
	rectfill(
		wall_left*grid_size,
		wall_top*grid_size,
		(wall_left+1)*grid_size-1,
		(wall_bottom+1)*grid_size-1,
		5)
	rectfill(
		wall_right*grid_size,
		wall_top*grid_size,
		(wall_right+1)*grid_size-1,
		(wall_bottom+1)*grid_size-1,
		5)
	-- draw fruit
	for f in all(fruits) do
		draw_fruit(f.x,f.y)
	end
	-- print stats
	print("len: "..#body,0,0,10)
	print("beat: "..move_beat,50,0,10)
	print("cpu: "..
		flr(100*stat(1)).."%"
		,100,0,6)
end -- end _draw

function update_gameover()
	if (btnp(❎))
	then
		_init()
	end
end

function draw_gameover()
	cls(8)
	print("died at length: "..#body,30,42,0)
	print("game over",46,60,0)
	print("press ❎",48,80,0)
end

function update_main_menu()
	if (btnp(❎)) initialize_game()
end

function draw_main_menu()
	cls(1)
	spr(32,64-8,64-8,2,2)
	print("snake game",42,42,11)
	print("press ❎ to start",28,80,11)
	print("zetlam 2024",80,120,3)
end

-->8
-- snake

function move_snake(dx,dy)
	for i=#body,2,-1 do
		body[i].x = body[i-1].x
		body[i].y = body[i-1].y
	end
	body[1].x += dx
	body[1].y += dy
end

function grow_snake()
	last = #body
	body[last+1] = {
		x=body[last].x,
		y=body[last].y,
	}
end

function draw_snake()
	for i=#body,1,-1 do
		-- head is blue
		if i==1 then
			cor=12
		else
			cor=11
		end
		rect(
			body[i].x*grid_size,
			body[i].y*grid_size,
			(body[i].x+1)*grid_size-1,
			(body[i].y+1)*grid_size-1,
			cor
		)
	end
end

-->8
-- fruit

function rand_coord()
	a=flr(rnd(10)+rnd(10)+rnd(10))+1
	b=flr(rnd(10)+rnd(10)+rnd(10))+1
	return {x=a, y=b}	
end

function is_snake_collision(x,y)
	for seg in all(body) do
		if (seg.x == x and seg.y == y) return true
	end
	return false
end

function create_fruit()
--	a=flr(rnd(wall_right-wall_left-1)+1),
--	b=flr(rnd(wall_bottom-wall_top-1)+1)
	a=flr(rnd(10)+rnd(10)+rnd(10))+1
	b=flr(rnd(10)+rnd(10)+rnd(10))+1
	repeat
		fruit = rand_coord()
	until not is_snake_collision(fruit.x, fruit.y) do
	end
	add(fruits, fruit)
end

function draw_fruit(x,y)
	rectfill(
		x*grid_size, y*grid_size,
		(x+1)*grid_size-1,
		(y+1)*grid_size-1,
		8)
end




__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000bbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bbbb1bb1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
300bbb272272b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
300bbbb7bb7b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08380bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8888800bbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888bb00000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888bbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
088800bbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08880000bbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
a555aaa5aa5555555555aaa5a5555555555555555555555555aaa5aaa5aaa5aaa555555555a55555555555555555555555555665666565655555555566556565
a555a555a5a55a55555555a5a5555555555555555555555555a5a5a555a5a55a555a555555a55555555555555555555555556555656565655655555556555565
a555aa55a5a5555555555aa5aaa55555555555555555555555aa55aa55aaa55a5555555555aaa555555555555555555555556555666565655555555556555655
a555a555a5a55a55555555a5a5a55555555555555555555555a5a5a555a5a55a555a555555a5a555555555555555555555556555655565655655555556556555
aaa5aaa1a1a111111111aaa1aaa11111111111111111111111aaa1aaa1a1a11a1111111111aaa111111111111111111111111661611116611111111166616565
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111888811111111ccccbbbbbbbbbbbbbbbbbbbbbbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111888811111111c11cb11bb11bb11bb11bb11bb11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111888811111111c11cb11bb11bb11bb11bb11bb11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111888811111111ccccbbbbbbbbbbbbbbbbbbbbbbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111b11b111111111111111111115555
5555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111bbbb111111111111111111115555
555511111111111111111111111111111111111111111111111111111111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb111111111111111111115555
555511111111111111111111111111111111111111111111111111111111111111111111b11bb11bb11bb11bb11bb11bb11bb11b111111111111111111115555
555511111111111111111111111111111111111111111111111111111111111111111111b11bb11bb11bb11bb11bb11bb11bb11b111111111111111111115555
555511111111111111111111111111111111111111111111111111111111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb111111111111111111115555
5555111111111111111111111111111111111111bbbbbbbbbbbbbbbbbbbb111111111111bbbb1111111111111111111111111111111111111111111111115555
5555111111111111111111111111111111111111b11bb11bb11bb11bb11b111111111111b11b1111111111111111111111111111111111111111111111115555
5555111111111111111111111111111111111111b11bb11bb11bb11bb11b111111111111b11b1111111111111111111111111111111111111111111111115555
5555111111111111111111111111111111111111bbbbbbbbbbbbbbbbbbbb111111111111bbbb1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111bbbb111111111111bbbb1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111b11b111111111111b11b1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111b11b111111111111b11b1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111bbbb111111111111bbbb1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111bbbbbbbbbbbbbbbbbbbb1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111b11bb11bb11bb11bb11b1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111b11bb11bb11bb11bb11b1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111bbbbbbbbbbbbbbbbbbbb1111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111115555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555

__sfx__
000100001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200001001019000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000900002242012410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000800001164019650186300b62005610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
